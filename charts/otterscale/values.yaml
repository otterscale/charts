# =============================================================================
# OtterScale Helm Chart Configuration
# =============================================================================
# This file contains all configurable parameters for the OtterScale deployment.
# Modify these values according to your environment and requirements.

# -----------------------------------------------------------------------------
# Chart Naming
# -----------------------------------------------------------------------------
# Override the chart name used in labels and resource names
nameOverride: ""
# Override the fully qualified app name
fullnameOverride: ""

# -----------------------------------------------------------------------------
# Global Settings
# -----------------------------------------------------------------------------
global:
  # Image pull policy for all containers
  # Options: Always, IfNotPresent, Never
  imagePullPolicy: IfNotPresent

  # Common pod configurations (can be overridden per component)
  podAnnotations: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}

# -----------------------------------------------------------------------------
# OtterScale PostgreSQL Database Configuration (Bitnami)
# -----------------------------------------------------------------------------
# This PostgreSQL instance is dedicated for OtterScale application
# Keycloak uses a separate PostgreSQL instance configured under keycloak.postgresql
postgresql:
  enabled: true
  image:
    repository: bitnamilegacy/postgresql
  auth:
    postgresPassword: ""
    username: "otterscale"
    password: ""
    database: "otterscale"

# -----------------------------------------------------------------------------
# OtterScale Service Configuration
# -----------------------------------------------------------------------------
otterscale:
  # Image configuration
  image:
    repository: ghcr.io/otterscale/otterscale/service
    tag: ""
    pullPolicy: "IfNotPresent"

  replicas: 1

  # Override global settings if needed
  podAnnotations: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}

  # Service port configuration
  service:
    type: ClusterIP
    port: 8299
    targetPort: 8299
    annotations: {}
    # NodePort (only used if type is NodePort)
    nodePort: ""

  # Additional environment variables
  env: []
  # - name: CUSTOM_VAR
  #   value: "value"

  # Environment variables from secrets or configmaps
  envFrom: []
  # - secretRef:
  #     name: my-secret

  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

openfeature:
  sidecar:
    enabled: true
  # Name of the FeatureFlagSource resource
  # This will be used in the pod annotation: openfeature.dev/featureflagsource
  flagsource: "otterscale-flags"
  # Feature flag configurations
  # Each entry will create a separate FeatureFlag resource
  flags:
    # Example: Add more flag configurations as needed
    # default-flags:
    #   enabled: false
    #   spec:
    #     some-feature:
    #       state: ENABLED
    #       variants:
    #         "on": true
    #         "off": false
    #       defaultVariant: "off"

# -----------------------------------------------------------------------------
# OtterScale Configuration File Content
# -----------------------------------------------------------------------------
# The content of otterscale.yaml configuration file
# This will be mounted as a ConfigMap
# Corresponds to CONFIG_VOLUME_PATH in environment configuration
configContent: |
  # OtterScale Service Configuration
  # This configuration file defines the service settings
  maas:
    url: http://127.0.0.1:5240/MAAS
    key: your_cert
    version: "2.0"

  juju:
    controller: maas-cloud-controller
    controller_addresses: []
    username: admin
    password: your_password
    ca_cert: |
      -----BEGIN CERTIFICATE-----
      xxxx
      -----END CERTIFICATE-----
    cloud_name: maas-cloud
    cloud_region: default
    charmhub_api_url: https://api.charmhub.io

  kube:
    helm_repository_urls:
    - https://charts.bitnami.com/bitnami

  ceph:
    rados_timeout: 0s

# -----------------------------------------------------------------------------
# OtterScale Web UI Configuration
# -----------------------------------------------------------------------------
otterscaleWeb:
  # Image configuration
  image:
    repository: ghcr.io/otterscale/otterscale/web
    tag: ""
    pullPolicy: "IfNotPresent"

  replicas: 1

  # Override global settings if needed
  podAnnotations: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}

  # Service port configuration
  service:
    type: ClusterIP
    port: 3000
    targetPort: 3000
    annotations: {}
    nodePort: ""

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

  # Application environment variables
  env:
    publicWebUrl: ""
    publicApiUrl: ""
    keycloakRealmUrl: ""
    keycloakClientID: ""
    keycloakClientSecret: ""

  # Additional environment variables
  extraEnv: []
  # - name: CUSTOM_VAR
  #   value: "value"

  # Environment variables from secrets or configmaps
  envFrom: []
  # - secretRef:
  #     name: my-secret

# -----------------------------------------------------------------------------
# Istio Configuration
# -----------------------------------------------------------------------------
istio:
  # Enable or disable Istio integration
  enabled: true

  # Automatic sidecar injection
  sidecarInjection:
    enabled: true

  # Gateway configuration for external traffic
  gateway:
    enabled: true
    name: otterscale-gateway
    servers:
      # HTTP server
      - port:
          number: 80
          name: http
          protocol: HTTP
        # List of hosts that the gateway should serve
        hosts:
          - "*"
        # Optional: redirect HTTP to HTTPS
        # tls:
        #   httpsRedirect: true

      # HTTPS server (uncomment and configure for TLS)
      # - port:
      #     number: 443
      #     name: https
      #     protocol: HTTPS
      #   hosts:
      #     - "otterscale.example.com"
      #   tls:
      #     mode: SIMPLE
      #     credentialName: otterscale-tls-cert

  # VirtualService configuration for traffic routing
  virtualService:
    enabled: true

  # Cookie Secure flag override for HTTP-only environments
  # WARNING: Only enable this for development/testing with HTTP
  # In production, use HTTPS instead
  cookieSecureOverride:
    enabled: true

# -----------------------------------------------------------------------------
# Keycloak Configuration
# -----------------------------------------------------------------------------
keycloak:
  enabled: true
  image:
    repository: bitnamilegacy/keycloak
  httpEnabled: true
  httpRelativePath: "/auth/"

  auth:
    adminUser: admin
    adminPassword: ""

  ## External Postgres
  postgresql:
    enabled: true
    nameOverride: "keycloak-postgres"
    image:
      repository: bitnamilegacy/postgresql

  ## Config realm
  keycloakConfigCli:
    enabled: true
    image:
      repository: bitnamilegacy/keycloak-config-cli
    configuration: {}
